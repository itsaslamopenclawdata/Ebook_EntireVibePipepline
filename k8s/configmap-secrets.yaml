# ConfigMap for application configuration
apiVersion: v1
kind: ConfigMap
metadata:
  name: vibe-pdf-config
  namespace: vibe-pdf
data:
  # Backend configuration
  DATABASE_POOL_SIZE: "20"
  DATABASE_MAX_OVERFLOW: "10"
  DATABASE_POOL_TIMEOUT: "30"
  
  # Redis configuration
  REDIS_MAX_CONNECTIONS: "50"
  REDIS_SOCKET_TIMEOUT: "5"
  
  # Application settings
  LOG_LEVEL: "INFO"
  CORS_ORIGINS: "https://vibe-pdf.example.com"
  
  # Celery settings
  CELERY_TASK_SERIALIZER: "json"
  CELERY_RESULT_SERIALIZER: "json"
  CELERY_ACCEPT_CONTENT: "json"
  CELERY_TIMEZONE: "UTC"
  CELERY_ENABLE_UTC: "true"
  CELERY_TASK_TRACK_STARTED: "true"
  CELERY_TASK_TIME_LIMIT: "3600"
  CELERY_TASK_SOFT_TIME_LIMIT: "3000"
  
  # PDF generation settings
  PDF_MAX_PAGES: "500"
  PDF_DEFAULT_DPI: "300"
  PDF_QUALITY: "high"
  
  # AI Agent settings
  ANTHROPIC_MODEL: "claude-3-opus-20240229"
  OPENAI_MODEL: "gpt-4-turbo-preview"
  GEMINI_MODEL: "gemini-pro"
  MAX_TOKENS: "4096"
  TEMPERATURE: "0.7"
---
# Secrets for sensitive data
apiVersion: v1
kind: Secret
metadata:
  name: vibe-pdf-secrets
  namespace: vibe-pdf
type: Opaque
stringData:
  # Database
  database-url: "postgresql://user:password@postgres:5432/vibepdf"
  redis-url: "redis://:password@redis:6379/0"
  
  # API Keys
  anthropic-api-key: "sk-ant-xxx"
  openai-api-key: "sk-xxx"
  google-gemini-api-key: "xxx"
  
  # JWT Secrets
  jwt-secret-key: "your-secret-key-change-in-production"
  jwt-algorithm: "HS256"
  access-token-expire-minutes: "30"
  
  # Google Drive
  google-client-id: "xxx"
  google-client-secret: "xxx"
  google-drive-folder-id: ""
---
# PostgreSQL StatefulSet
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: postgres
  namespace: vibe-pdf
spec:
  serviceName: postgres
  replicas: 1
  selector:
    matchLabels:
      app: postgres
  template:
    metadata:
      labels:
        app: postgres
    spec:
      containers:
        - name: postgres
          image: postgres:15-alpine
          env:
            - name: POSTGRES_USER
              value: "user"
            - name: POSTGRES_PASSWORD
              valueFrom:
                secretKeyRef:
                  name: vibe-pdf-secrets
                  key: database-url
            - name: POSTGRES_DB
              value: "vibepdf"
          ports:
            - containerPort: 5432
          volumeMounts:
            - name: postgres-data
              mountPath: /var/lib/postgresql/data
          resources:
            requests:
              memory: "256Mi"
              cpu: "100m"
            limits:
              memory: "1Gi"
              cpu: "500m"
  volumeClaimTemplates:
    - metadata:
        name: postgres-data
      spec:
        accessModes: ["ReadWriteOnce"]
        resources:
          requests:
            storage: 10Gi
---
# Redis StatefulSet
apiVersion: apps/v1
kind: StatefulSet
metadata:
  name: redis
  namespace: vibe-pdf
spec:
  serviceName: redis
  replicas: 1
  selector:
    matchLabels:
      app: redis
  template:
    metadata:
      labels:
        app: redis
    spec:
      containers:
        - name: redis
          image: redis:7-alpine
          command:
            - redis-server
            - --requirepass
            - "password"
            - --maxmemory
            - "512mb"
            - --maxmemory-policy
            - "allkeys-lru"
          ports:
            - containerPort: 6379
          volumeMounts:
            - name: redis-data
              mountPath: /data
          resources:
            requests:
              memory: "256Mi"
              cpu: "100m"
            limits:
              memory: "1Gi"
              cpu: "500m"
  volumeClaimTemplates:
    - metadata:
        name: redis-data
      spec:
        accessModes: ["ReadWriteOnce"]
        resources:
          requests:
            storage: 2Gi
