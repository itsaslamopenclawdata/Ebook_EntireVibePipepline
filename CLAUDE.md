<claude-mem-context>
# Recent Activity

<!-- This section is auto-generated by claude-mem. Edit content outside the tags. -->

*No recent activity*
</claude-mem-context>

# Vibe PDF Book Generation Platform - Complete Reference

> AI-powered platform for generating professional PDF books with hierarchical chapters, AI-generated infographics, and Google Drive integration.

---

## Project Overview

| Aspect | Details |
|--------|---------|
| **Tech Stack** | Python 3.11, FastAPI, React 18, TypeScript, PostgreSQL, Redis, Celery |
| **AI/LLM** | LangGraph, Anthropic Claude, OpenAI GPT-4, Google Gemini |
| **Frontend** | Vite, Zustand, Tailwind CSS, Neo-Brutalism design |
| **Infrastructure** | Docker, Docker Compose, Alembic, MCP Servers |
| **Total Tasks** | 117 tasks across 5 tracks |

---

## Quick Start

```bash
# Start all services
docker-compose up -d

# Verify services
docker-compose ps
curl http://localhost:8000/health

# Frontend
cd Frontend && npm install && npm run dev
```

### Service Ports

| Service | Port | Purpose |
|---------|------|---------|
| PostgreSQL | 5432 | Primary database |
| Redis | 6379 | Cache & message broker |
| Backend API | 8000 | FastAPI application |
| Celery Worker | - | Background tasks |
| Flower | 5555 | Celery monitoring UI |
| Frontend | 3000 | React dev server |

---

## Track Dependencies

```
Track A (Infrastructure)
    │
    ├──→ Track B (Backend APIs)
    │        │
    │        └──→ Track C (AI Agents)
    │                   │
    └───────────────────┴──→ Track E (Testing & Deployment)
                    │
Track D (Frontend) ─┘ (parallel with A, B, C)
```

---

# Track A: Infrastructure & Setup

## Overview
Establishes foundational infrastructure with containerized services, project structure, and configuration management.

**Status**: Independent - no prerequisites

## 30 Tasks by Phase

### Phase 1: Root Setup (Tasks 1-3)
- Project directory structure initialization
- Docker Compose configuration (5 services)
- Environment configuration (.env templates)

### Phase 2: Backend Structure (Tasks 4-7)
- Complete backend directory structure
- Python requirements.txt (pinned versions)
- Production Dockerfile (multi-stage, LaTeX support)
- Pydantic Settings configuration module

### Phase 3: Database (Tasks 8-13)
- Logging configuration
- SQLAlchemy base models with TimestampMixin
- Async database session management
- ORM models: User, Book, Chapter, GenerationTask
- Alembic migrations setup
- Initial database migration

### Phase 4: API Foundation (Tasks 14-19)
- FastAPI main application entry point
- Placeholder API routers (auth, books, generation, websocket)
- Celery configuration
- Placeholder Celery tasks
- Security module (password hashing, JWT)
- Pydantic schemas

### Phase 5: Frontend (Tasks 20-26)
- Frontend directory structure (Vite + React + TypeScript)
- package.json with all dependencies
- Vite configuration with path aliases
- TypeScript configuration
- Tailwind CSS with Neo-Brutalism theme
- Entry points (index.html, main.tsx, App.tsx)
- ESLint and Prettier configuration

### Phase 6: Documentation & Scripts (Tasks 27-30)
- Root .gitignore
- Comprehensive README
- Database initialization scripts
- Development workspace setup scripts

## Critical Files

1. `docker-compose.yml` - Core infrastructure definition
2. `Backend/app/core/config.py` - Central configuration management
3. `Backend/requirements.txt` - Python dependencies
4. `Backend/app/db/base.py` - Base ORM model
5. `Frontend/package.json` - Frontend dependencies

## Deliverables Checklist

- [ ] Docker Compose starts all services without errors
- [ ] PostgreSQL accepts connections (port 5432)
- [ ] Redis accessible (port 6379)
- [ ] Backend responds to /health (port 8000)
- [ ] Celery worker connected to Redis
- [ ] Flower UI accessible (port 5555)
- [ ] Frontend dev server starts (port 3000)

---

# Track B: Backend Core Logic & APIs

## Overview
Complete backend implementation: REST API endpoints, authentication, database operations, storage abstraction, WebSocket server, and Celery orchestration.

**Prerequisites**: Track A (Docker, PostgreSQL, Redis)

## Quick Reference

```bash
http://localhost:8000/docs     # Swagger UI
http://localhost:8000/redoc    # ReDoc
curl http://localhost:8000/health
```

## 20 Tasks by Phase

### Phase 1: Data Layer (Tasks 1-5)
- Database models (User, Book, Chapter, GenerationTask)
- Pydantic v2 schemas (request/response validation)
- Security module (JWT tokens, password hashing)
- Database session management (async engine)
- Alembic migrations with async support

### Phase 2: Authentication (Tasks 6-7)
- Auth service layer (registration, login, Google OAuth)
- Auth API endpoints (/register, /login, /google/*, /refresh, /logout)

### Phase 3: Storage & Books (Tasks 8-10)
- Storage abstraction (local filesystem + Google Drive)
- Book service layer (CRUD, pagination, filtering)
- Books API endpoints (GET /books, GET /books/{id}, DELETE)

### Phase 4: Background Processing (Tasks 11-13)
- Celery configuration (Redis broker, task queues)
- Generation service layer (start, track, cancel, retry)
- Generation API endpoints (/generation/*)

### Phase 5: Real-time & Main App (Tasks 14-17)
- WebSocket server (real-time progress updates)
- FastAPI main application (lifespan, CORS, routing)
- Error handling middleware (custom exceptions, rate limiting)
- OpenAPI documentation configuration

### Phase 6: Testing & Docker (Tasks 18-20)
- Database seed and utility scripts
- pytest setup with async support, 80%+ coverage
- Production Docker configuration

## API Endpoints

### Authentication (`/api/v1/auth`)
| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | /register | Create new user |
| POST | /login | Email/password login |
| GET | /google/auth-url | Get OAuth URL |
| POST | /google/callback | Complete OAuth |
| POST | /refresh | Refresh tokens |
| POST | /logout | Invalidate session |

### Books (`/api/v1/books`)
| Method | Endpoint | Description |
|--------|----------|-------------|
| GET | /books | List books (paginated, filtered) |
| GET | /books/{id} | Get book details |
| DELETE | /books/{id} | Delete book |

### Generation (`/api/v1/generation`)
| Method | Endpoint | Description |
|--------|----------|-------------|
| POST | /start | Start book generation |
| GET | /progress/{book_id} | Get progress |
| POST | /cancel/{book_id} | Cancel generation |
| POST | /retry/{book_id} | Retry failed |

## Database Models

```
User                 Book                  Chapter              GenerationTask
├── id (UUID)        ├── id (UUID)         ├── id (UUID)        ├── id (UUID)
├── email            ├── user_id (FK)      ├── book_id (FK)     ├── book_id (FK)
├── hashed_password  ├── title             ├── chapter_number   ├── celery_task_id
├── google_id        ├── status (enum)     ├── title            ├── status
├── name             ├── input_method      ├── content          ├── result (JSON)
├── avatar_url       ├── progress_%        ├── infographic_url  ├── error
├── is_active        ├── current_step      ├── page_start/end   ├── started_at
└── is_superuser     └── drive_url         └── level            └── completed_at
```

## Celery Queues

| Queue | Purpose |
|-------|---------|
| celery | Default queue |
| generation | Book generation tasks |
| image_gen | Infographic generation |
| pdf_compile | PDF compilation |
| drive_upload | Google Drive uploads |

## Critical Files

1. `Backend/app/services/auth_service.py` - Authentication logic
2. `Backend/app/api/v1/generation.py` - Generation endpoints
3. `Backend/app/services/storage/service.py` - Storage abstraction
4. `Backend/app/tasks/generation_tasks.py` - Background tasks
5. `Backend/app/main.py` - FastAPI application entry point

---

# Track C: AI Agents & Content Generation Pipeline

## Overview
Core AI-powered content generation: LangGraph orchestration, four specialized agents, Celery tasks, and MCP integrations.

**Prerequisites**: Track A (Infrastructure), Track B (Backend API)

## Architecture

```
User Input → LangGraph Orchestration
                    │
    ┌───────────────┼───────────────┐
    ▼               ▼               ▼
Outline Agent → Content Agent → Infographic Agent → PDF Agent
    │               │               │                  │
    └───────────────┴───────────────┴──────────────────┘
                            │
                    MCP Integrations
                            │
                    Google Drive Upload
```

## 21 Tasks by Phase

### Phase 1: LangGraph Foundation (C.1-C.3)
- LLM Provider Factory (Anthropic, OpenAI, Google with fallback)
- LangGraph orchestration graph skeleton
- Base agent classes and utilities

### Phase 2: Specialized Agents (C.4-C.7)
- Outline Generator Agent (input → hierarchical outline)
- Content Writer Agent (outline → chapter content)
- Infographic Creator Agent (content → visual images)
- PDF Formatter Agent (all content → LaTeX PDF)

### Phase 3: Celery Integration (C.8-C.10)
- Celery application configuration
- Background generation tasks
- Task status tracking and recovery

### Phase 4: MCP Integrations (C.11-C.15)
- MCP integration base layer
- Google Drive MCP (PDF upload, sharing)
- LaTeX PDF MCP (LaTeX → PDF conversion)
- PDF Manipulation MCP (merge, compress, page numbers)
- Markdown to PDF MCP (preview generation)

### Phase 5: API Integration (C.16-C.18)
- Generation API endpoints
- WebSocket progress notifications
- MCP Orchestrator service

### Phase 6: Testing & Docs (C.19-C.21)
- Agent unit tests
- Integration tests for pipeline
- Agent documentation

## Four LangGraph Deep Agents

### 1. Outline Generator Agent
- **Input**: User topic/outline/sheet URL
- **Output**: Hierarchical chapter structure
- 3 depth levels (Basics, Level 1, Level 2)
- Max 12 chapters, 3 levels deep

### 2. Content Writer Agent
- **Input**: Chapter outline
- **Output**: Comprehensive chapter content
- Target word count per chapter
- Consistency maintenance across chapters

### 3. Infographic Creator Agent
- **Input**: Chapter content
- **Output**: Visual infographic image
- DALL-E API integration
- Rate limit handling

### 4. PDF Formatter Agent
- **Input**: All chapters + infographics
- **Output**: Professional PDF
- LaTeX template rendering
- XeLaTeX compilation

## MCP Server Integrations

| MCP Server | Purpose | Key Operations |
|------------|---------|----------------|
| Google Drive | Cloud storage | upload_file, get_share_link |
| latexpdf-mcp | PDF compilation | compile_pdf |
| mcp-pdf | PDF manipulation | add_page_numbers, merge, compress |
| md-pdf-mcp | Preview generation | convert_chapter_to_pdf |

## WebSocket Message Types

```typescript
{ type: "progress_update", book_id, progress: { percentage, current_step } }
{ type: "generation_complete", book_id, pdf_path, drive_url }
{ type: "generation_error", book_id, error_message }
```

## Critical Files

1. `Backend/app/agents/graph.py` - LangGraph orchestration
2. `Backend/app/agents/outline_agent.py` - Outline generation
3. `Backend/app/agents/content_agent.py` - Content writing
4. `Backend/app/services/llm/factory.py` - LLM provider abstraction
5. `Backend/app/integrations/orchestrator.py` - MCP coordination

---

# Track D: Frontend & UI Components

## Overview
Complete React + TypeScript frontend: Vite setup, Zustand state management, all UI components, Dashboard and Book Creation views, Neo-Brutalism styling.

**Prerequisites**: Minimal - Node.js 18+. Can develop in parallel with backend.

## Quick Start

```bash
cd Frontend
npm install
npm run dev          # Port 3000
npm run build
npm run lint
```

## 13 Phases Overview

### Phase 1-3: Foundation
- Vite + React + TypeScript project
- Tailwind CSS with Neo-Brutalism theme
- Type definitions (User, Book, API, WebSocket, Store)
- Utility functions (cn, date, validation)

### Phase 4: Zustand Stores
- **authStore**: Login, logout, token management
- **booksStore**: Book data, pagination
- **uiStore**: Theme, sidebar, modals, toasts
- **websocketStore**: Real-time connection management
- **bookCreationStore**: Multi-step form state

### Phase 5-6: UI Components
- Base: Button, Input, Card, Modal, Select, Toast, Spinner
- Book: BookCard, StatusBadge, ProgressIndicator

### Phase 7-8: Feature Components
- Dashboard: Header, FilterSidebar, BookGrid, Pagination
- Book Creation: Stepper, InputMethodTabs, Forms, Panels

### Phase 9-13: Integration
- Custom hooks (form, error, navigation, filters)
- Views (Dashboard, BookCreation, Auth, BookDetail)
- WebSocket integration
- Form components (FileUpload, Toggle)
- Testing, responsive, accessibility

## Project Structure

```
Frontend/src/
├── components/
│   ├── ui/          # Button, Input, Card, Modal, Toast
│   ├── book/        # BookCard, StatusBadge, ProgressIndicator
│   ├── dashboard/   # Header, FilterSidebar, BookGrid, Pagination
│   ├── book-creation/ # Stepper, Forms, Panels
│   ├── form/        # Select, Toggle, FileUpload
│   ├── layout/      # AppLayout, Header, Sidebar
│   └── auth/        # GoogleAuthButton
├── hooks/           # Custom hooks
├── stores/          # Zustand stores
├── types/           # TypeScript definitions
├── lib/             # Utilities (api/, validation/)
├── views/           # Page components
└── constants/       # App constants
```

## Neo-Brutalism Theme

```javascript
colors: {
  primary: '#FF6B6B',    // Coral red
  secondary: '#4ECDC4',  // Teal
  accent: '#FFE66D',     // Yellow
}
fonts: {
  sans: 'Inter',
  display: 'Space Grotesk',
  mono: 'JetBrains Mono',
}
boxShadow: {
  'neo-sm': '2px 2px 0px 0px rgba(0,0,0,1)',
  'neo-md': '4px 4px 0px 0px rgba(0,0,0,1)',
}
```

## Views

### Dashboard View
- Header with search, view toggle (grid/list), create button
- Collapsible filter sidebar (status, date range)
- Book grid/list with pagination
- WebSocket subscription for real-time updates

### Book Creation View
- 3-step wizard: Input → Configure → Review
- Input methods: Single-line, Outline, Google Sheet
- Book configuration (depth, page count estimate)

## Critical Files

1. `Frontend/src/stores/booksStore.ts` - Core state management
2. `Frontend/src/components/ui/button.tsx` - Base Neo-Brutalism component
3. `Frontend/src/types/book.ts` - Core type definitions
4. `Frontend/src/views/DashboardView.tsx` - Main view integration
5. `Frontend/tailwind.config.js` - Design system configuration

---

# Track E: Testing, MCP Integration & Deployment

## Overview
Testing infrastructure, MCP server integrations, production deployment, CI/CD pipeline, and documentation.

**Prerequisites**: Tracks A-D for full testing. Test framework can start immediately.

## 10 Phases / 26 Tasks

### Phase 1-2: Test Setup
- Backend pytest with async support (80%+ coverage)
- Frontend Playwright for E2E

### Phase 3-5: Test Implementation
- Unit tests: LangGraph agents, services, API endpoints
- Integration tests: Database, Celery, MCP
- E2E tests: Critical user flows with Playwright
- Load tests: Locust performance validation

### Phase 6: MCP Integration
- Google Drive MCP (PDF storage, sharing)
- LaTeX PDF MCP (LaTeX → PDF conversion)
- PDF Manipulation MCP (merge, compress, page numbers)
- Markdown to PDF MCP (preview generation)
- MCP Orchestrator (coordinates all servers)

### Phase 7: Deployment
- Production environment configuration
- Production Docker images (multi-stage builds)
- Database migration strategy

### Phase 8: CI/CD
- GitHub Actions pipeline (lint, test, build, deploy)
- Monitoring: Prometheus, Grafana, Fluentd

### Phase 9-10: Documentation & Verification
- API, deployment, testing, MCP documentation
- Smoke test suite
- Pre-production checklist

## Performance Targets

| Metric | Target |
|--------|--------|
| API p50 | < 200ms |
| API p95 | < 500ms |
| API p99 | < 1000ms |
| Concurrent Users | 100 |
| Requests/Second | 50 sustained |

## CI/CD Pipeline Stages

```
1. Lint (ESLint, Prettier, Ruff/Black)
2. Type Check (TypeScript, mypy)
3. Unit Tests (pytest, vitest)
4. Integration Tests (API, Database)
5. E2E Tests (Playwright)
6. Build (Docker image)
7. Security Scan (Trivy, Snyk)
8. Deploy (Staging → Production)
```

## MCP Operations

```python
# Google Drive
upload_file(file_path, folder_id)
get_share_link(file_id)

# LaTeX PDF
compile_pdf(latex_content, template_path)

# PDF Manipulation
add_page_numbers(pdf_path, position, format)
merge_pdfs(pdf_paths, output_path)
compress_pdf(pdf_path, quality)

# Markdown PDF
convert_chapter_to_pdf(markdown_content, css_path)
```

## Pre-Production Checklist

### Security
- [ ] JWT secret key rotated
- [ ] SSL/TLS certificates valid
- [ ] CORS configured for production
- [ ] Rate limiting enabled
- [ ] Secrets not in version control

### Performance
- [ ] Load tests pass
- [ ] Database indexes created
- [ ] Caching configured

### Operations
- [ ] Monitoring dashboards configured
- [ ] Alert rules set up
- [ ] Backup schedule configured
- [ ] Rollback plan documented

## Critical Files

1. `Backend/tests/conftest.py` - Central test configuration
2. `Backend/app/integrations/orchestrator.py` - MCP coordination
3. `.github/workflows/ci.yml` - CI/CD pipeline
4. `config/docker-compose.prod.yml` - Production deployment
5. `Backend/app/core/config.py` - Configuration management

---

## Key Environment Variables

```bash
# Application
APP_ENV=development
SECRET_KEY=<jwt-secret>

# Database
DATABASE_URL=postgresql+asyncpg://user:pass@localhost:5432/vibepdf
REDIS_URL=redis://localhost:6379/0

# Authentication
GOOGLE_OAUTH_CLIENT_ID=<client-id>
GOOGLE_OAUTH_CLIENT_SECRET=<secret>

# LLM Providers
ANTHROPIC_API_KEY=<key>
OPENAI_API_KEY=<key>
GOOGLE_AI_API_KEY=<key>
LLM_PROVIDER_PRIORITY=anthropic,openai,google

# Storage
GOOGLE_CREDENTIALS_PATH=/app/credentials/google.json
GOOGLE_DRIVE_FOLDER_ID=<folder-id>
```

---

## All Critical Files Summary

| Track | File | Purpose |
|-------|------|---------|
| A | `docker-compose.yml` | Infrastructure definition |
| A | `Backend/app/core/config.py` | Configuration management |
| A | `Backend/requirements.txt` | Python dependencies |
| B | `Backend/app/services/auth_service.py` | Authentication logic |
| B | `Backend/app/api/v1/generation.py` | Generation endpoints |
| B | `Backend/app/main.py` | FastAPI entry point |
| C | `Backend/app/agents/graph.py` | LangGraph orchestration |
| C | `Backend/app/services/llm/factory.py` | LLM abstraction |
| C | `Backend/app/integrations/orchestrator.py` | MCP coordination |
| D | `Frontend/src/stores/booksStore.ts` | State management |
| D | `Frontend/src/views/DashboardView.tsx` | Main view |
| E | `Backend/tests/conftest.py` | Test configuration |
| E | `.github/workflows/ci.yml` | CI/CD pipeline |
